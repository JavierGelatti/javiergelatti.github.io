const a=document.querySelector("main"),f=a.querySelector("article"),y=a.querySelector("svg"),c=[],k=O().origin;f.addEventListener("scroll",()=>u());f.parentElement.addEventListener("scroll",()=>u());const E=new ResizeObserver(()=>u());E.observe(document.documentElement);document.documentElement.addEventListener("click",e=>{var n;if(!(e.target instanceof HTMLElement))return;const t=(n=e.target)==null?void 0:n.closest("a");if(t&&t.classList.contains("local"))if(e.preventDefault(),t.classList.contains("active")){const i=c.find(o=>o.sourceLink===t);h(i)}else t.classList.add("active"),R(t)});S();function u(){c.forEach(e=>{const t=e.svgPath,n=e.sourceParentElement.getBoundingClientRect(),i=e.sourceLink.getBoundingClientRect(),o=document.body.scrollLeft,r=document.body.scrollTop;let l=i.x-1+i.width+o,s=i.y+i.height/2+r;const v=e.element.getBoundingClientRect(),m=v.x+o,d=v.y+10+r;if(s<n.y)l=n.right+o,s=n.top+8+r;else if(s>n.bottom){const p=n.bottom;l+=(p-s)*(m-l)/(d-s),s=p}t.classList.toggle("out",s===n.bottom);const L=20;t.setAttribute("d",`
        M ${l},${s}
        C ${l+L},${s} ${m-L},${d} ${m},${d}
    `)})}function O(){return new URL(document.location.href)}function P(e){return e.closest(".content-viewer")??void 0}function g(){sessionStorage.setItem("sideViewers",JSON.stringify(c.map(e=>{const t=e.sourceLink.href,n=b(e.sourceParentElement,t).indexOf(e.sourceLink);return{href:t,linkIndex:n}})))}function S(e=x()){var s;if(e.length===0)return;const[{href:t,linkIndex:n},...i]=e,o=((s=c[c.length-1])==null?void 0:s.element)??f,r=b(o,t);if(r.length===0)throw g(),new Error(`Link not found: ${t}`);(r.length>1?r[n]:r[0]).click(),setTimeout(()=>S(i),100)}function b(e,t){return[...e.querySelectorAll("a")].filter(n=>new URL(n.href).toString()===t)}function x(){const e=sessionStorage.getItem("sideViewers")??"[]";return JSON.parse(e)}function w(e,t){const n=P(e),i=c.find(l=>l.sourceParentElement===n);i&&h(i);const o=document.createElement("article");o.className="content-viewer",o.replaceChildren(t),E.observe(o);const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.style.stroke=e.style.background,y.append(r),B({element:o,sourceLink:e,sourceParentElement:n,svgPath:r})}function R(e){const t=new URL(e.href);C(t)?w(e,$()):w(e,V(t))}function V(e){const t=document.createElement("iframe");return t.src=e.toString(),t.classList.add("loading"),t.onload=()=>t.classList.remove("loading"),t}function $(e){const t=document.createElement("div");return t.classList.add("loading"),t}function B(e){c.push(e),a.style.setProperty("--number-of-columns",String(c.length+1)),a.insertBefore(e.element,y),u(),e.element.addEventListener("scroll",()=>u()),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}),g()}function h(e){e.svgPath.remove(),e.element.remove(),e.sourceLink.classList.remove("active");const t=c.indexOf(e),n=c.at(t+1);n&&h(n),c.splice(t,1),a.style.setProperty("--number-of-columns",String(c.length+1)),g()}function C(e){return e.origin===k&&(e.pathname.endsWith(".html")||e.pathname==="/")}
